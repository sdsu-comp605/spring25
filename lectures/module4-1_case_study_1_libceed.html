
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>14) Case Study 1: libCEED &#8212; Scientific Computing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/module4-1_case_study_1_libceed';</script>
    <link rel="icon" href="../_static/SDSU-comp605_logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="15) Case Study 2: ClimaCore" href="module4-2_case_study_2_climacore.html" />
    <link rel="prev" title="13) More on OpenMP and OpenMP Tasks" href="module3-3_openmp_tasks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-light" alt="Scientific Computing - Home"/>
    <script>document.write(`<img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-dark" alt="Scientific Computing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../lectures.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="module1-1_first_class.html">1) First Class: Reproducibility and Git</a></li>


<li class="toctree-l2"><a class="reference internal" href="module1-2_linux.html">2) The Linux Filesystem and commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-3_community_projects.html">3) Community Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-4_intro_architectures.html">4) Introduction to Computer Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-5_intro_vectorization.html">5) Introduction to Vectorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-1_measuring_performance.html">6) Measuring Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-2_cpu_optimization.html">7) CPU Optimization: Matrix-Matrix Multiply</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-3_blocked_mmm.html">8) Blocked Matrix-Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-4_packing_for_cache.html">9) Packing for cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-5_intro_multithreading.html">10) Introduction to Multithreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-1_intro_parallel_scaling.html">11) Introduction to Parallel Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-2_intro_to_openmp.html">12) Introduction to OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-3_openmp_tasks.html">13) More on OpenMP and OpenMP Tasks</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">14) Case Study 1: libCEED</a></li>
<li class="toctree-l2"><a class="reference internal" href="module4-2_case_study_2_climacore.html">15) Case Study 2: ClimaCore</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25/issues/new?title=Issue%20on%20page%20%2Flectures/module4-1_case_study_1_libceed.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/module4-1_case_study_1_libceed.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>14) Case Study 1: libCEED</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-the-finite-spectral-element-method">1. Introduction to the Finite/Spectral Element Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-free-methods">2. Matrix-free methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">2.1 Motivation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed">3. libCEED</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed-s-operator-decomposition-and-api-objects">3.1 libCEED’s operator decomposition and API objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">3.2 Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed-s-python-interface">3.3 libCEED’s python interface</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="case-study-1-libceed">
<h1>14) Case Study 1: <a class="reference external" href="https://github.com/CEED/libCEED">libCEED</a><a class="headerlink" href="#case-study-1-libceed" title="Link to this heading">#</a></h1>
<p>Last time:</p>
<ul class="simple">
<li><p>OpenMP Tasks</p></li>
</ul>
<p>Today:</p>
<ol class="arabic simple">
<li><p>Introduction to Finite/Spectral Element Method</p></li>
<li><p>Matrix-free methods<br />
2.1 Motivation</p></li>
<li><p>libCEED<br />
3.1 libCEED’s operator decomposition and API objects
3.2 Performance<br />
3.3 libCEED’s python interface</p></li>
</ol>
<section id="introduction-to-the-finite-spectral-element-method">
<h2>1. Introduction to the Finite/Spectral Element Method<a class="headerlink" href="#introduction-to-the-finite-spectral-element-method" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>In Finite Element Methods (FEM) formulations, the weak form of a Partial Differential Equation (PDE)-which involves integrating all terms in the PDE over the domain-is evaluated on a subdomain <span class="math notranslate nohighlight">\(\Omega_e\)</span> (element) and the local results are composed into a larger system of equations that models the entire problem on the global domain <span class="math notranslate nohighlight">\(\Omega\)</span>.</p></li>
<li><p>A finite element space is a function space in which each function is approximated with a finite-dimensional polynomial interpolation in each element. A Spectral Element Method (SEM) is a high-order (“exponential/spectral”) FEM, in which the nodes are non-equispaced.</p></li>
<li><p>Most FEM/SEM packages use polynomials as <em>basis functions</em> to approximate a given function (e.g., solution state). There are different ways of defininig basis functions: <em>nodal</em> basis functions and <em>modal</em> basis functions. Most FEM/SEM packages use <em>nodal</em> basis functions (e.g. by using Lagrange interpolation), which are defined via the values of the polynomials at particular nodal points in each element (termed Finite Element <em>nodes</em>).</p></li>
</ul>
<p>For an overview of function approximation via interpolation and quadrature, please refer to the relevant Comp526 <a class="reference external" href="https://sdsu-comp526.github.io/fall24/slides/module7-1_interpolation.html">Interpolation</a> and <a class="reference external" href="https://sdsu-comp526.github.io/fall24/slides/module8-2_quadrature.html">Quadrature</a> lectures. Recall how Gauss-Legendre quadrature is defined:</p>
<p>We approximate the integral of a function <span class="math notranslate nohighlight">\(f(x)\)</span> by a weighted sum of function values:</p>
<div class="math notranslate nohighlight">
\[
\int_{-1}^{-1} f(x) dx \approx \sum_{i=1}^{n} w_i f(x_i)
\]</div>
<p>where <span class="math notranslate nohighlight">\(w_i\)</span> are the weights defined as</p>
<div class="math notranslate nohighlight">
\[
w_i = \int_{-1}^{1}L_i(x) dx \quad i=1, \dots, n
\]</div>
<p>the Lagrange interpolating polynomial with <span class="math notranslate nohighlight">\(n\)</span> interpolating nodes, and the quadrature nodes <span class="math notranslate nohighlight">\(x_i\)</span> are the roots of the <span class="math notranslate nohighlight">\(n\)</span>-th Legendre polynomial on <span class="math notranslate nohighlight">\([-1,1]\)</span>.</p>
<p>In CG SEM formulations, Gauss-Lobatto nodes are preferred because they include nodes at the endpoints <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span>, hence ensuring continuity of the basis functions across element boundaries. This gives rise to Legendre-Gauss-Lobatto (LGL or GLL) quadrature.</p>
<ul class="simple">
<li><p>Even though the basis functions can interpolate globally, it’s better to limit each function to interpolate locally within each element, so to avoid a dense matrix system of equations when adding up the element contributions on the
global domain <span class="math notranslate nohighlight">\(\Omega\)</span>.</p></li>
<li><p>The Finite Element nodes can be chosen to coincide with those of a particular <em>quadrature rule</em>, (this is referred to as using <em>collocated</em> nodes) which allows us to integrate functions over the domain without having the souble cost of defining the interpolating polynomial nodes and the quadrature rule nodes.</p></li>
</ul>
<p>Let us give a concrete example of strong and weak form of a PDE.</p>
<p>A Poisson’s problem (in <strong>strong form</strong>) is given by</p>
<div class="math notranslate nohighlight">
\[
   \nabla \cdot \nabla u = f, \textrm{ for  } \mathbf{x} \in \Omega .
\]</div>
<p>To obtain the <strong>weak form</strong>, let us multiply all terms by a test function <span class="math notranslate nohighlight">\(v\)</span> and integrate by parts (i.e., apply Gauss’ divergence theorem in multiple dimensions):</p>
<div class="math notranslate nohighlight">
\[
   \int_\Omega \nabla v \cdot \nabla u \, dV - \int_{\partial \Omega} v \nabla u \cdot \hat{\mathbf n}\, dS = \int_\Omega  v f \, dV .
\]</div>
<p>Often, we choose to represent a field (say, the velocity field) such that <span class="math notranslate nohighlight">\(\nabla u \cdot \hat{\mathbf n} = 0\)</span> for which all boundary integrals would cancel each other at neighboring elements and boundary of the domain, so that we’re only left with the volumetric parts of the equation above. This holds in Continuous Galerkin (CG) formulations, whereas boundary integrals do not vanish - and need to be solved for, using Riemann solvers - in Discontinuous Galerkin (DG formulations.</p>
<p>Most SEM packages use the Legendre-Gauss-Lobatto (LGL) quadrature nodes that we have seen earlier in the course amd take advantage of <strong>tensor-product</strong> basis functions on quadrilateral or hexaedral elements.</p>
</section>
<section id="matrix-free-methods">
<h2>2. Matrix-free methods<a class="headerlink" href="#matrix-free-methods" title="Link to this heading">#</a></h2>
<section id="motivation">
<h3>2.1 Motivation<a class="headerlink" href="#motivation" title="Link to this heading">#</a></h3>
<p>Historically, conventional high-order finite element methods were rarely used for industrial problems because the Jacobian rapidly loses sparsity as the order is increased, leading to unaffordable solve times and memory requirements.</p>
<blockquote>
<div><p>Recommended Reading: <a class="reference external" href="https://link.springer.com/article/10.1007/s10915-010-9396-8">Efficient Nonlinear Solvers for Nodal High-Order Finite Elements in 3D</a></p>
</div></blockquote>
<p>This effect typically limited the order of accuracy to at most quadratic, especially because quadratic finite element formulations are computationally advantageous in terms of floating point operations (FLOPS) per degree of freedom (DOF) despite the fast convergence and favorable stability properties offered by higher order discretizations (see below).</p>
<p><img alt="Matrix-free cost" src="../_images/MatrixFreePerfPlot.PNG" /></p>
<p>In the figure above, we analyze and compare the theoretical costs, of different configurations: assembling the sparse matrix representing the action of the operator (labeled as <em>assembled</em>), non assembling the matrix and storing only the metric terms needed as an operator setup-phase (labeled as <em>tensor-qstore</em>) and non assembling  the matrix and computing the metric terms on the fly and storing a compact representation of the linearization at quadrature points (labeled as <em>tensor</em>). In the right panel, we show the cost in terms of FLOPS/DOF.</p>
<ul class="simple">
<li><p>This metric for computational efficiency made sense historically, when the performance was mostly limited by processors’ clockspeed.</p></li>
<li><p>A more relevant performance plot for current state-of-the-art high-performance machines (for which the bottleneck of performance is mostly in the memory bandwith) is shown in the left panel of the figure, where the memory bandwith is measured in terms of bytes/DOF.</p></li>
<li><p>We can see that high-order methods, implemented properly with only partial assembly, require optimal amount of memory transfers (with respect to the polynomial order) and near-optimal FLOPs for operator evaluation.</p></li>
<li><p>Thus, high-order methods in matrix-free representation not only possess favorable properties, such as higher accuracy and faster convergence to solution, but also manifest an efficiency gain compared to their corresponding assembled representations.</p></li>
<li><p>Nowadays, high-order numerical methods, such as the spectral element method (SEM)-a special case of nodal p-Finite Element Method (FEM) which can reuse the interpolation nodes for quadrature-are employed, especially with (nearly) affine elements, because linear constant coefficient problems can be very efficiently solved using the fast diagonalization method combined with a multilevel coarse solve.</p></li>
</ul>
</section>
</section>
<section id="libceed">
<h2>3. <a class="reference external" href="https://github.com/CEED/libCEED">libCEED</a><a class="headerlink" href="#libceed" title="Link to this heading">#</a></h2>
<p>Motivation:</p>
<ul class="simple">
<li><p>For decades, high-order numerical methods have been considered too expensive</p></li>
<li><p>A sparse matrix is no longer a good representation for high-order operators. In particular, the Jacobian of a nonlinear operator is known to rapidly lose sparsity as the order is increased</p></li>
<li><p>libCEED uses a matrix-free operator description, based on a purely algebraic interface, where user only specifies action of weak form operators</p></li>
<li><p>libCEED operator representation is optimal with respect to the FLOPs needed for its evaluation, as well as the memory transfer needed for operator evaluations (matvec)</p>
<ul>
<li><p>Matrix-free operators that exploit tensor-product structures reduce the compute work load from <span class="math notranslate nohighlight">\(O(p^{2d})\)</span> (for sparse matrices) to <span class="math notranslate nohighlight">\(O(p)\)</span>, and memory storage from <span class="math notranslate nohighlight">\(O(p^d)\)</span> (for sparse matrices) to <span class="math notranslate nohighlight">\(O(1)\)</span> per degree of freedom (DOF) in <span class="math notranslate nohighlight">\(d\)</span> dimensions</p></li>
</ul>
</li>
<li><p>Primary target for libCEED: high-order finite/spectral element methods (FEM/SEM) exploiting tensor-product structure; but it can also work with other discretizations</p></li>
<li><p>Open source (BSD-2 license) C library with Fortran, Python, Julia, and Rust interfaces</p></li>
</ul>
<p><img alt="libCEED's backends" src="../_images/libCEEDBackends.svg" /></p>
<p>The figure above illustrates the role of libCEED as a lightweight, portable library which provides a low-level API for efficient, specialized implementations. libCEED allows different applications to share highly optimized discretization kernels.</p>
<section id="libceed-s-operator-decomposition-and-api-objects">
<h3>3.1 libCEED’s operator decomposition and API objects<a class="headerlink" href="#libceed-s-operator-decomposition-and-api-objects" title="Link to this heading">#</a></h3>
<p>As mentioned above, in FEM/SEM formulations, the solution is evaluated on a subdomain <span class="math notranslate nohighlight">\(\Omega_e\)</span> (element) and the local results are composed into a larger system of equations that models the entire problem on the global domain <span class="math notranslate nohighlight">\(\Omega\)</span>.</p>
<ul class="simple">
<li><p>libCEED’s API is defined in terms of decomposition (and composition) of operators.</p></li>
</ul>
<p><img alt="libCEED's operator decomposition" src="../_images/libCEEDDecomposition.PNG" /></p>
<ul class="simple">
<li><p>Each of these operators are then composed to form the PDE (in weak form) that describes a physical process.</p></li>
</ul>
<p><img alt="libCEED's API objects" src="../_images/libCEEDAPIObjects.png" /></p>
<ul class="simple">
<li><p>In libCEED’s decomposition, the operator describing the “physics” of the problem is defined by <span class="math notranslate nohighlight">\(D\)</span>, and is applied only point-wise on quadrature nodes. Therefore, the point-wise functions are called “<span class="math notranslate nohighlight">\(Q\)</span>-functions” in libCEED’s terminology.</p></li>
</ul>
<p><img alt="libCEED's QFunctions" src="../_images/libCEED_QFunctions.png" /></p>
<ul class="simple">
<li><p>There are six main API objects (classes) in libCEED:</p></li>
</ul>
<p><img alt="libCEED's API classes" src="../_images/libCEEDClasses.png" /></p>
</section>
<section id="performance">
<h3>3.2 Performance<a class="headerlink" href="#performance" title="Link to this heading">#</a></h3>
<p>To measure performance, a set of benchmark (bake-off) problems have been defined:</p>
<p><img alt="CEED Benchmark Problems" src="../_images/CEEDBPs.PNG" /></p>
<ul class="simple">
<li><p>In what follows, we will present some performance plots for BP3 (i.e., a Poisson’s problem in <span class="math notranslate nohighlight">\(3\)</span>D). The numbers (i.e., peak performance) attained are now outdated. But we will focus on the big picture of the performance behaviors observed.</p></li>
<li><p>In libCEED’s terminology, “<em>serial</em>” means that the physical operator has been applied to one element at a time, not serially/sequentially. All the results presented here use parallel computations on multi-processor systems with the Message Passing Interface (MPI) and different levels of optimizations/backends that can be selected at runtime (i.e., without having to recompile your code).</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/cpu/self/*/serial</span></code> backends process one element at a time and are intended for meshes with a smaller number of high order elements. The <code class="docutils literal notranslate"><span class="pre">/cpu/self/*/blocked</span></code> backends process blocked batches of eight interlaced elements and are intended for meshes with higher numbers of elements.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/cpu/self/ref/*</span></code> backends are written in pure C and provide basic (“vanilla”) reference functionality without any optimization.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/cpu/self/avx/*</span></code> backends rely upon AVX instructions to provide vectorized CPU performance.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/cpu/self/xsmm/*</span></code> backends rely upon the <a class="reference external" href="http://github.com/hfp/libxsmm">LIBXSMM</a> package to provide vectorized CPU performance, optimized for matrix-matrix multiplies.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/gpu/cuda/*</span></code> backends provide GPU performance strictly using CUDA.</p></li>
</ul>
</li>
</ul>
<p>In the performance plots below, we measure efficiency on the <span class="math notranslate nohighlight">\(y\)</span>-axis and use different spectra on the <span class="math notranslate nohighlight">\(x\)</span>-axis, mainly, problem size in terms of points (or degrees of freedom - DOF) or time. The efficiency on the <span class="math notranslate nohighlight">\(y\)</span>-axis is measured in terms of</p>
<div class="math notranslate nohighlight">
\[
\frac{\textrm{DOFs} \times \textrm{Conjugate Gradient iterations}}{\textrm{compute nodes} \times \textrm{seconds}}
\]</div>
<ul class="simple">
<li><p>Reference backend on CPU, serial implementation, processing one element at a time (left) Vs blocked (right):</p></li>
</ul>
<p><img alt="libCEED's performance ref backend serial Vs blocked wrt points" src="../_images/libCEED_perf_ref_serial_blocked_points.png" /></p>
<blockquote>
<div><p>Q: Where do we see the strong-scaling regime in these graphs?</p>
</div></blockquote>
<ul class="simple">
<li><p>Reference backend on CPU, serial implementation, processing one element at a time (left) Vs blocked (right), but with time on the <span class="math notranslate nohighlight">\(x\)</span>-axis:</p></li>
</ul>
<p><img alt="libCEED's performance ref backend serial Vs blocked wrt time" src="../_images/libCEED_perf_ref_serial_blocked_time.png" /></p>
<ul class="simple">
<li><p>AVX backend on CPU, blocked implementation with time on the <span class="math notranslate nohighlight">\(x\)</span>-axis (left), and points on the <span class="math notranslate nohighlight">\(x\)</span>-axis (right): (Notice the <span class="math notranslate nohighlight">\(y\)</span>-axis units! From this graph onward we have GFlops as unit)</p></li>
</ul>
<p><img alt="libCEED's performance AVX backend blocked wrt time and points" src="../_images/libCEED_perf_AVX_blocked_points_and_time.png" /></p>
<ul class="simple">
<li><p>XSMM backend on CPU, blocked implementation with time on the <span class="math notranslate nohighlight">\(x\)</span>-axis (left), and points on the <span class="math notranslate nohighlight">\(x\)</span>-axis (right), on a Skylake architecture:</p></li>
</ul>
<p><img alt="libCEED's performance XSMM backend blocked wrt time and points on Skylake" src="../_images/libCEED_perf_XSMM_blocked_on_EPYC_time_and_points.png" /></p>
<blockquote>
<div><p>Q: Why the performance drops? What are they due to?</p>
</div></blockquote>
<ul class="simple">
<li><p>CUDA backend on GPU, blocked implementation with points on the <span class="math notranslate nohighlight">\(x\)</span>-axis:</p></li>
</ul>
<p><img alt="libCEED's performance CUDA backend blocked wrt points" src="../_images/libCEED_perf_CUDA_gen.png" /></p>
</section>
<section id="libceed-s-python-interface">
<h3>3.3 libCEED’s python interface<a class="headerlink" href="#libceed-s-python-interface" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>libCEED’s python interface was developed using the C Foreign Function Interface (CFFI) and you can set the underlying vector’s arrays via <code class="docutils literal notranslate"><span class="pre">numpy</span></code> (on CPUs) or <code class="docutils literal notranslate"><span class="pre">numba</span></code> (on GPUs)</p></li>
</ul>
<p><img alt="libCEED's python interface" src="../_images/libCEEDPythonInterface.png" /></p>
<ul class="simple">
<li><p>You can simply initialize a vector of a given length:</p></li>
</ul>
<p><img alt="libCEED's python interface - initialize vector" src="../_images/libCEEDPython_initialize_vector.png" /></p>
<ul class="simple">
<li><p>Example: Set Vector data and Element Restriction operators</p></li>
</ul>
<p><img alt="libCEED's python interface - set vector and restriction" src="../_images/libCEEDPython_vec_and_restriction.png" /></p>
<ul class="simple">
<li><p>Compare the C and Python (more user-friendly) APIs:</p></li>
</ul>
<p><img alt="libCEED's C and python interfaces" src="../_images/libCEED_python_vs_C.png" /></p>
<blockquote>
<div><p><strong>Recommended Readings</strong>:</p>
<ul class="simple">
<li><p>For more details on the Python interface, check this <a class="reference external" href="https://proceedings.scipy.org/articles/Majora-342d178e-00c">SciPy 2020 paper</a>.</p></li>
<li><p>For everything else, including detailed descriptions of examples, see <a class="reference external" href="https://libceed.org/en/latest/">libCEED’s documentation</a>.</p></li>
</ul>
</div></blockquote>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "sdsu-comp605/spring25",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="module3-3_openmp_tasks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">13) More on OpenMP and OpenMP Tasks</p>
      </div>
    </a>
    <a class="right-next"
       href="module4-2_case_study_2_climacore.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">15) Case Study 2: ClimaCore</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-to-the-finite-spectral-element-method">1. Introduction to the Finite/Spectral Element Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-free-methods">2. Matrix-free methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">2.1 Motivation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed">3. libCEED</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed-s-operator-decomposition-and-api-objects">3.1 libCEED’s operator decomposition and API objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">3.2 Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#libceed-s-python-interface">3.3 libCEED’s python interface</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Valeria Barra
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>