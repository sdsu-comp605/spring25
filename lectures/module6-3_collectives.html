
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>23) Collective communication &#8212; Scientific Computing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/module6-3_collectives';</script>
    <link rel="icon" href="../_static/SDSU-comp605_logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="22) Blocking and non-blocking communication" href="module6-2_blocking_vs_nonblocking.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-light" alt="Scientific Computing - Home"/>
    <script>document.write(`<img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-dark" alt="Scientific Computing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../lectures.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="module1-1_first_class.html">1) First Class: Reproducibility and Git</a></li>


<li class="toctree-l2"><a class="reference internal" href="module1-2_linux.html">2) The Linux Filesystem and commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-3_community_projects.html">3) Community Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-4_intro_architectures.html">4) Introduction to Computer Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-5_intro_vectorization.html">5) Introduction to Vectorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-1_measuring_performance.html">6) Measuring Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-2_cpu_optimization.html">7) CPU Optimization: Matrix-Matrix Multiply</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-3_blocked_mmm.html">8) Blocked Matrix-Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-4_packing_for_cache.html">9) Packing for cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-5_intro_multithreading.html">10) Introduction to Multithreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-1_intro_parallel_scaling.html">11) Introduction to Parallel Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-2_intro_to_openmp.html">12) Introduction to OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-3_openmp_tasks.html">13) More on OpenMP and OpenMP Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="module4-1_case_study_1_libceed.html">14) Case Study 1: libCEED</a></li>
<li class="toctree-l2"><a class="reference internal" href="module4-2_case_study_2_climacore.html">15) Case Study 2: ClimaCore</a></li>
<li class="toctree-l2"><a class="reference internal" href="hw2_notebook.html">16) HW2 solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="module5-1_reductions_and_scans.html">17) Parallel reductions and scans</a></li>
<li class="toctree-l2"><a class="reference internal" href="module5-2_intro_to_mpi.html">18) Introduction to MPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="module5-3_intro_to_slurm.html">19) Introduction to Batch Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="module5-4_parallel_linear_alegebra.html">20) Parallel Linear Algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="module6-1_intro_to_mpi_jl.html">21) Introduction to MPI.jl</a></li>
<li class="toctree-l2"><a class="reference internal" href="module6-2_blocking_vs_nonblocking.html">22) Blocking and non-blocking communication</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">23) Collective communication</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25/issues/new?title=Issue%20on%20page%20%2Flectures/module6-3_collectives.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/module6-3_collectives.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>23) Collective communication</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mpi-collective-communication">1. MPI Collective Communication</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reductions">Reductions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-trees-mst">2. Minimum Spanning Trees (MST)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#broadcast">2.1 Broadcast</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-algorithm">Naive Algorithm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-tree-algorithm">Minimum Spanning Tree Algorithm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-compare-them">Let’s compare them</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-tree-reduce">Minimum Spanning Tree Reduce?</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="collective-communication">
<h1>23) Collective communication<a class="headerlink" href="#collective-communication" title="Link to this heading">#</a></h1>
<p>Last time:</p>
<ul class="simple">
<li><p>Blocking and non-blocking point-to-point communications</p></li>
</ul>
<p>Today:</p>
<ol class="arabic simple">
<li><p>MPI Collective Communication</p></li>
<li><p>Minimum Spanning Trees</p></li>
</ol>
<section id="mpi-collective-communication">
<h2>1. MPI Collective Communication<a class="headerlink" href="#mpi-collective-communication" title="Link to this heading">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Resources for the lecture:</p>
<ol class="arabic simple">
<li><p>Article: Chan et al., <a class="reference external" href="https://csu-sdsu.primo.exlibrisgroup.com/permalink/01CALS_SDL/10r4g1c/cdi_crossref_primary_10_1002_cpe_1206"><em>Collective communication: theory, practice, and experience</em></a></p></li>
<li><p>Lecture Notes from the University of Texas at Austin: Robert van de Geijn (RVDG) <a class="reference external" href="https://www.cs.utexas.edu/~rvdg/tmp/CollectiveCommunication.pdf"><em>Collective Communication: Theory and Practice</em></a></p></li>
</ol>
</div>
<p>In the previous lecture we considered point-to-point communication, that is communication between two MPI ranks. In this lecture we will consider communication that involves <em>all</em> the ranks in a communicator.</p>
<section id="reductions">
<h3>Reductions<a class="headerlink" href="#reductions" title="Link to this heading">#</a></h3>
<p>Recall that <a class="reference external" href="https://en.wikipedia.org/wiki/Reduction_operator">reductions</a> are a case of collective communication operations.</p>
<blockquote>
<div><p>An operator is a reduction operator if:</p>
<ol class="arabic simple">
<li><p>It can reduce an array to a single scalar value.</p></li>
<li><p>The final result should be obtainable from the results of the partial tasks that were created.</p></li>
</ol>
</div></blockquote>
<p>These two requirements are satisfied for <strong>commutative</strong> and <strong>associative</strong> operators that are applied to <em>all</em> array elements.</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h4>
<p>Suppose we have an array <span class="math notranslate nohighlight">\(x = [1,2,3,4,5,6,7,8]\)</span>. The sum of this array can be computed <em>serially</em> by sequentially reducing the array into a single sum using the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator.</p>
<p>Starting the summation from the beginning of the array yields:</p>
<div class="math notranslate nohighlight">
\[
(((((((1 + 2) + 3) + 4) + 5) + 6) + 7) + 8)
\]</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">+</span></code> is both <em>commutative</em> and <em>associative</em>, it is a reduction operator. Therefore this reduction can be performed in parallel using several processes/cores, where each process/core computes the sum of a subset of the array, and the reduction operator merges the results.</p>
<p>Using a <a class="reference external" href="https://en.wikipedia.org/wiki/Binary_tree">binary tree</a> reduction would allow <span class="math notranslate nohighlight">\(4\)</span> processes/cores to compute</p>
<div class="math notranslate nohighlight">
\[
\underbrace{ \underbrace{ \underbrace{(1 + 2)}_{p_0} + \underbrace{(3 + 4)}_{p_1}}_{p_0} + \underbrace{ \underbrace{(5 + 6)}_{p_1} + \underbrace{(7 + 8)}_{p_3}}_{p_1} }_{p_0}
\]</div>
<p>So a total of <span class="math notranslate nohighlight">\(4\)</span> cores can be used to compute the sum in <span class="math notranslate nohighlight">\(\log_n \equiv \log_2 8 = 3\)</span> steps instead of the <span class="math notranslate nohighlight">\(7\)</span> steps required for the serial version.</p>
<p>Of course the result is the same, but only because of the associativity of the reduction operator. The commutativity of the reduction operator would be important if there were a master core distributing work to several processors, since then the results could arrive back to the master processor in any order. The property of commutativity guarantees that the result will be the same.</p>
<ul class="simple">
<li><p>From Fig. 1 in Chan et al.</p></li>
</ul>
<p><img alt="Figure 1 of Chang et al, Collective communication: theory, practice, and experience article" src="../_images/MPI_collective_comm_Chang_et_al_fig1.png" /></p>
<p>Types of possible collective communication:</p>
<ul class="simple">
<li><p>Broadcast: one rank sends data to all the other ranks (RVDG: 93, <code class="docutils literal notranslate"><span class="pre">MPI_Bcast</span></code>)</p></li>
<li><p>Reduce(-to-one): Combine (e.g., <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>/<code class="docutils literal notranslate"><span class="pre">min</span></code>, etc.) information from all ranks to one rank (RVDG: 94, <code class="docutils literal notranslate"><span class="pre">MPI_Reduce</span></code>)</p></li>
<li><p>Scatter: One rank send data to all other ranks (RVDG: 96, <code class="docutils literal notranslate"><span class="pre">MPI_Scatter</span></code>)</p></li>
<li><p>Gather: All ranks send data to one rank (RVDG: 97, <code class="docutils literal notranslate"><span class="pre">MPI_Gather</span></code>)</p></li>
<li><p>Allgather: All ranks sends information to all ranks (RVDG: 99, <code class="docutils literal notranslate"><span class="pre">MPI_Allgather</span></code>)</p></li>
<li><p>Reduce-scatter: Reduce and scatter out the reduced result (RVDG: 101, <code class="docutils literal notranslate"><span class="pre">MPI_Reduce_scatter</span></code>)</p></li>
<li><p>Allreduce: All ranks combine information from all ranks and the result is available to all ranks (RVDG: 102, <code class="docutils literal notranslate"><span class="pre">MPI_Allreduce</span></code>)</p></li>
</ul>
<p>Note that there are pairs of reciprocal/dual operations:</p>
<ul class="simple">
<li><p>Broadcast/Reduce(-to-one) (RVDG: 95)</p></li>
<li><p>Scatter/Gather (RVDG: 98)</p></li>
<li><p>Allgather/Reduce-scatter (RVDG: 101)</p></li>
</ul>
<p>Allreduce is the only operationthat does not have a dual (or it can be viewed as its own dual).</p>
<p>Two broad classes of collective operations (Chan et al., 1752):</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Data redistribution operations:</em> Broadcast, scatter, gather, and allgather. These operations move data between processors.</p></li>
<li><p><em>Data consolidation operations:</em> Reduce(-to-one), reduce–scatter, and allreduce. These operations consolidate contributions from different processors by applying a reduction operation. We will only consider reduction operations that are both commutative and associative.</p></li>
</ul>
</div></blockquote>
</section>
</section>
</section>
<section id="minimum-spanning-trees-mst">
<h2>2. <a class="reference external" href="https://en.wikipedia.org/wiki/Parallel_algorithms_for_minimum_spanning_trees">Minimum Spanning Trees (MST)</a><a class="headerlink" href="#minimum-spanning-trees-mst" title="Link to this heading">#</a></h2>
<section id="broadcast">
<h3>2.1 Broadcast<a class="headerlink" href="#broadcast" title="Link to this heading">#</a></h3>
<p>We want to perform a broadcast operation, i.e., we want to send a message from a root rank to all ranks.</p>
<section id="naive-algorithm">
<h4>Naive Algorithm<a class="headerlink" href="#naive-algorithm" title="Link to this heading">#</a></h4>
<p>A naive broadcast just has the root send the message to each rank.</p>
<p>You can find the following code at <a class="reference external" href="https://github.com/sdsu-comp605/spring25/tree/main/julia_codes/module6-3/naivebcast.jl"><code class="docutils literal notranslate"><span class="pre">julia_codes/module6-3/naivebcast.jl</span></code></a>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c"># Naive broadcast just has the root send the message to each rank</span>
<span class="linenos"> 2</span><span class="k">function</span><span class="w"> </span><span class="n">naivebcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="c"># Figure out who we are</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="c"># If I am the root send the message to everyone</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">root</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="c"># How many total ranks are there</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="n">mpisize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">    </span><span class="c"># Create an array for the requests</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">reqs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Array</span><span class="p">{</span><span class="kt">MPI</span><span class="o">.</span><span class="kt">Request</span><span class="p">}(</span><span class="nb">undef</span><span class="p">,</span><span class="w"> </span><span class="n">mpisize</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="c"># Loop through ranks and send message</span>
<span class="linenos">15</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">mpisize</span>
<span class="linenos">16</span><span class="w">      </span><span class="c"># MPI uses 0 based indexing for ranks</span>
<span class="linenos">17</span><span class="w">      </span><span class="n">neighbor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">1</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">      </span><span class="c"># If its me jst set my request to NULL (e.g., no-op)</span>
<span class="linenos">20</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">neighbor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mpirank</span>
<span class="linenos">21</span><span class="w">        </span><span class="n">reqs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">REQUEST_NULL</span>
<span class="linenos">22</span><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="c"># otherwise send message to neighbor</span>
<span class="linenos">23</span><span class="w">        </span><span class="n">reqs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Isend</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">neighbor</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">24</span><span class="w">      </span><span class="k">end</span>
<span class="linenos">25</span><span class="w">    </span><span class="k">end</span>
<span class="linenos">26</span><span class="w">    </span><span class="c"># Wait on all the requests</span>
<span class="linenos">27</span><span class="w">    </span><span class="n">MPI</span><span class="o">.</span><span class="n">Waitall!</span><span class="p">(</span><span class="n">reqs</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="c"># Since we are not the root, we receive</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">MPI</span><span class="o">.</span><span class="n">Recv!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">end</span>
<span class="linenos">31</span><span class="k">end</span>
</pre></div>
</div>
<p>And the following testing code at <a class="reference external" href="https://github.com/sdsu-comp605/spring25/tree/main/julia_codes/module6-3/naivebcast_test.jl"><code class="docutils literal notranslate"><span class="pre">julia_codes/module6-3/naivebcast_test.jl</span></code></a>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">using</span><span class="w"> </span><span class="n">MPI</span>
<span class="linenos"> 2</span><span class="n">include</span><span class="p">(</span><span class="s">&quot;naivebcast.jl&quot;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">let</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="c"># Initialize MPI</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="c"># store communicator</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">mpicomm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">  </span><span class="c"># Get some MPI info</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">mpisize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">  </span><span class="c"># Divide all ranks halfway to determine the root</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">mpisize</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># Integer division</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">  </span><span class="c"># create buffer for the communication</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mpirank</span><span class="p">]</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="c"># have root broadcast message to everyone</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">naivebcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">  </span><span class="c"># check to make sure we got back the right message</span>
<span class="linenos">25</span><span class="w">  </span><span class="nd">@assert</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">root</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@elapsed</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">naivebcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">30</span><span class="w">    </span><span class="n">MPI</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">31</span><span class="w">  </span><span class="k">end</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="w">  </span><span class="c"># Let&#39;s print the execution time:</span>
<span class="linenos">34</span><span class="w">  </span><span class="c"># Short hand for:</span>
<span class="linenos">35</span><span class="w">  </span><span class="cm">#=</span>
<span class="linenos">36</span><span class="cm">  if mpirank == 0</span>
<span class="linenos">37</span><span class="cm">    print(&quot;Execution time: &quot;, time,&quot;\n&quot;)</span>
<span class="linenos">38</span><span class="cm">  end</span>
<span class="linenos">39</span><span class="cm">  =#</span>
<span class="linenos">40</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Execution time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="w">  </span><span class="c"># shutdown MPI</span>
<span class="linenos">43</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Finalize</span><span class="p">()</span>
<span class="linenos">44</span><span class="k">end</span>
</pre></div>
</div>
</section>
<section id="minimum-spanning-tree-algorithm">
<h4>Minimum Spanning Tree Algorithm<a class="headerlink" href="#minimum-spanning-tree-algorithm" title="Link to this heading">#</a></h4>
<p>See Chan et al. Fig. 3(a) &amp; Fig 4(a); RVDG pages 108-171.</p>
<p>You can find the following code at <a class="reference external" href="https://github.com/sdsu-comp605/spring25/tree/main/julia_codes/module6-3/mstbcast.jl"><code class="docutils literal notranslate"><span class="pre">julia_codes/module6-3/mstbcast.jl</span></code></a>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c"># Example implementation of MSTBcast (Fig. 3(a)) from</span>
<span class="linenos"> 2</span><span class="c"># Chan, E., Heimlich, M., Purkayastha, A. and van de Geijn, R. (2007),</span>
<span class="linenos"> 3</span><span class="c"># Collective communication: theory, practice, and experience. Concurrency</span>
<span class="linenos"> 4</span><span class="c"># Computat.: Pract. Exper., 19: 1749–1783. doi:10.1002/cpe.1206</span>
<span class="linenos"> 5</span><span class="c">#</span>
<span class="linenos"> 6</span><span class="c"># In this minimum spanning tree (mst) broadcast algorithm:</span>
<span class="linenos"> 7</span><span class="c">#   - Divide ranks into two (almost) equal group</span>
<span class="linenos"> 8</span><span class="c">#   - root sends data to one rank in other group (called the dest)</span>
<span class="linenos"> 9</span><span class="c">#   - recurse on two groups with root and dest being the &quot;roots&quot; of respective</span>
<span class="linenos">10</span><span class="c">#     groups</span>
<span class="linenos">11</span><span class="c">#</span>
<span class="linenos">12</span><span class="c">#  For nine ranks with root = 1 the algorithm would be (letters just represent</span>
<span class="linenos">13</span><span class="c">#  who sends/recvs data)</span>
<span class="linenos">14</span><span class="c">#</span>
<span class="linenos">15</span><span class="c">#  0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8</span>
<span class="linenos">16</span><span class="c">#  ---------------------------------</span>
<span class="linenos">17</span><span class="c">#    | x |   |   |   |   |   |   |</span>
<span class="linenos">18</span><span class="c">#    | a |   |   |   |   |   |   | a  1-&gt;8</span>
<span class="linenos">19</span><span class="c">#    | a |   |   | a |   | b |   | b  1-&gt;4, 8-&gt;6</span>
<span class="linenos">20</span><span class="c">#    | a | a | c | c | d | d | b | b  1-&gt;2, 4-&gt;3, 6-&gt;5, 8-&gt;7</span>
<span class="linenos">21</span><span class="c">#  a | a | x | x | x | x | x | x | x  1-&gt;0</span>
<span class="linenos">22</span><span class="k">function</span><span class="w"> </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">;</span>
<span class="linenos">23</span><span class="w">                   </span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="c"># If there is no one else, let&#39;s get outta here!</span>
<span class="linenos">26</span><span class="w">  </span><span class="n">left</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">return</span>
<span class="linenos">27</span><span class="w">  </span><span class="c"># Short hand for:</span>
<span class="linenos">28</span><span class="w">  </span><span class="cm">#=</span>
<span class="linenos">29</span><span class="cm">  if left == right</span>
<span class="linenos">30</span><span class="cm">    return</span>
<span class="linenos">31</span><span class="cm">  end</span>
<span class="linenos">32</span><span class="cm">  =#</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="w">  </span><span class="c"># Determine the split</span>
<span class="linenos">35</span><span class="w">  </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">right</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># integer division</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">  </span><span class="c"># Whom do I send to?</span>
<span class="linenos">38</span><span class="w">  </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">root</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">left</span>
<span class="linenos">39</span><span class="w">  </span><span class="c"># Short hand for:</span>
<span class="linenos">40</span><span class="w">  </span><span class="cm">#=</span>
<span class="linenos">41</span><span class="cm">  if root &lt;= mid</span>
<span class="linenos">42</span><span class="cm">    dest = right;</span>
<span class="linenos">43</span><span class="cm">  else</span>
<span class="linenos">44</span><span class="cm">    dest = left;</span>
<span class="linenos">45</span><span class="cm">  end</span>
<span class="linenos">46</span><span class="cm">  =#</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="w">  </span><span class="c"># Figure out who we are</span>
<span class="linenos">49</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="w">  </span><span class="c"># If I&#39;m the root or dest send or recv (respectively)</span>
<span class="linenos">52</span><span class="w">  </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">REQUEST_NULL</span>
<span class="linenos">53</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">root</span>
<span class="linenos">54</span><span class="w">    </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Isend</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">55</span><span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dest</span>
<span class="linenos">56</span><span class="w">    </span><span class="n">MPI</span><span class="o">.</span><span class="n">Recv!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">57</span><span class="w">  </span><span class="k">end</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="w">  </span><span class="c"># Recursion:</span>
<span class="linenos">60</span><span class="w">  </span><span class="c"># I&#39;m in the left group and the root is my new root</span>
<span class="linenos">61</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span>
<span class="linenos">62</span><span class="w">    </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">;</span><span class="w"> </span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>
<span class="linenos">63</span><span class="w">  </span><span class="c"># I&#39;m in the left group and the dest is my new root</span>
<span class="linenos">64</span><span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mid</span>
<span class="linenos">65</span><span class="w">    </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">;</span><span class="w"> </span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="o">=</span><span class="n">mid</span><span class="p">)</span>
<span class="linenos">66</span><span class="w">  </span><span class="c"># I&#39;m in the right group and the dest is my new root</span>
<span class="linenos">67</span><span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">mid</span>
<span class="linenos">68</span><span class="w">    </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="o">=</span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
<span class="linenos">69</span><span class="w">  </span><span class="c"># I&#39;m in the right group and the root is my new root</span>
<span class="linenos">70</span><span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="n">mpirank</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mid</span>
<span class="linenos">71</span><span class="w">    </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="o">=</span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
<span class="linenos">72</span><span class="w">  </span><span class="k">end</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="w">  </span><span class="c"># Make sure all my sends are done before I get outta dodge</span>
<span class="linenos">75</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Wait!</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="linenos">76</span><span class="k">end</span>
</pre></div>
</div>
<p>And the following testing code at <a class="reference external" href="https://github.com/sdsu-comp605/spring25/tree/main/julia_codes/module6-3/mstbcast_test.jl"><code class="docutils literal notranslate"><span class="pre">julia_codes/module6-3/mstbcast_test.jl</span></code></a>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">using</span><span class="w"> </span><span class="n">MPI</span>
<span class="linenos"> 2</span><span class="n">include</span><span class="p">(</span><span class="s">&quot;mstbcast.jl&quot;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">let</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="c"># Initialize MPI</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="c"># store communicator</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">mpicomm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">  </span><span class="c"># Get some MPI info</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">mpisize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">  </span><span class="c"># Divide all ranks halfway to determine the root</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">mpisize</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># Integer division</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">  </span><span class="c"># create buffer for the communication</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mpirank</span><span class="p">]</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="c"># have root broadcast message to everyone</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">  </span><span class="c"># check to make sure we got back the right message</span>
<span class="linenos">25</span><span class="w">  </span><span class="nd">@assert</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">root</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">28</span><span class="w">  </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@elapsed</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">30</span><span class="w">    </span><span class="n">MPI</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">31</span><span class="w">  </span><span class="k">end</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="w">  </span><span class="c"># Let&#39;s print the execution time:</span>
<span class="linenos">34</span><span class="w">  </span><span class="c"># Short hand for:</span>
<span class="linenos">35</span><span class="w">  </span><span class="cm">#=</span>
<span class="linenos">36</span><span class="cm">  if mpirank == 0</span>
<span class="linenos">37</span><span class="cm">    print(&quot;Execution time: &quot;, time,&quot;\n&quot;)</span>
<span class="linenos">38</span><span class="cm">  end</span>
<span class="linenos">39</span><span class="cm">  =#</span>
<span class="linenos">40</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Execution time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="w">  </span><span class="c"># shutdown MPI</span>
<span class="linenos">43</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Finalize</span><span class="p">()</span>
<span class="linenos">44</span><span class="k">end</span>
</pre></div>
</div>
</section>
<section id="let-s-compare-them">
<h4>Let’s compare them<a class="headerlink" href="#let-s-compare-them" title="Link to this heading">#</a></h4>
<p>You can find the driver for the comparison code at <a class="reference external" href="https://github.com/sdsu-comp605/spring25/tree/main/julia_codes/module6-3/bcast_compare.jl"><code class="docutils literal notranslate"><span class="pre">julia_codes/module6-3/bcast_compare.jl</span></code></a>.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">using</span><span class="w"> </span><span class="n">MPI</span>
<span class="linenos"> 2</span><span class="n">include</span><span class="p">(</span><span class="s">&quot;naivebcast.jl&quot;</span><span class="p">)</span>
<span class="linenos"> 3</span><span class="n">include</span><span class="p">(</span><span class="s">&quot;mstbcast.jl&quot;</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="k">let</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="c"># Initialize MPI</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="c"># store communicator</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">mpicomm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">  </span><span class="c"># Get some MPI info</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_rank</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">mpisize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MPI</span><span class="o">.</span><span class="n">Comm_size</span><span class="p">(</span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">  </span><span class="c"># Divide all ranks halfway to determine the root</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">mpisize</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="c"># Integer division</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="w">  </span><span class="c"># create buffer for the communication</span>
<span class="linenos">19</span><span class="w">  </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mpirank</span><span class="p">]</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">  </span><span class="c"># have root broadcast message to everyone</span>
<span class="linenos">22</span><span class="w">  </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">naivebcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">mst_t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_ns</span><span class="p">()</span><span class="w"> </span><span class="c"># The time_ns() function in Julia returns the current time in nanoseconds</span>
<span class="linenos">26</span><span class="w">  </span><span class="n">mstbcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">27</span><span class="w">  </span><span class="n">mst_t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">28</span><span class="w">  </span><span class="n">nve_t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">29</span><span class="w">  </span><span class="n">naivebcast!</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">mpicomm</span><span class="p">)</span>
<span class="linenos">30</span><span class="w">  </span><span class="n">nve_t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_ns</span><span class="p">()</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Elapsed time for the naive algorithm: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="linenos">33</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nd">@show</span><span class="w"> </span><span class="p">(</span><span class="n">nve_t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nve_t1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e-9</span>
<span class="linenos">34</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Elapsed time for the mst algorithm: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="linenos">35</span><span class="w">  </span><span class="n">mpirank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nd">@show</span><span class="w"> </span><span class="p">(</span><span class="n">mst_t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mst_t1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e-9</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">  </span><span class="c"># shutdown MPI</span>
<span class="linenos">38</span><span class="w">  </span><span class="n">MPI</span><span class="o">.</span><span class="n">Finalize</span><span class="p">()</span>
<span class="linenos">39</span><span class="k">end</span>
</pre></div>
</div>
</section>
</section>
<section id="minimum-spanning-tree-reduce">
<h3>Minimum Spanning Tree Reduce?<a class="headerlink" href="#minimum-spanning-tree-reduce" title="Link to this heading">#</a></h3>
<p>For a <strong>Minimum Spanning Tree (MST) Reduce</strong> see See Chan et al. Fig. 3(b) &amp; Fig. 4(b); RVDG pages 172-184.</p>
<ul class="simple">
<li><p><strong>Note</strong>: It’s possible to write the <code class="docutils literal notranslate"><span class="pre">mstbcast</span></code> (and a corresponding MST reduce version) without recursion (although we won’t see it in this class) and doing it with blocking communication is easier than non-blocking…</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "sdsu-comp605/spring25",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="module6-2_blocking_vs_nonblocking.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">22) Blocking and non-blocking communication</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mpi-collective-communication">1. MPI Collective Communication</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reductions">Reductions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-trees-mst">2. Minimum Spanning Trees (MST)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#broadcast">2.1 Broadcast</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#naive-algorithm">Naive Algorithm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-tree-algorithm">Minimum Spanning Tree Algorithm</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-compare-them">Let’s compare them</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-spanning-tree-reduce">Minimum Spanning Tree Reduce?</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Valeria Barra
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>