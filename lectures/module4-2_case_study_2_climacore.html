
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>15) Case Study 2: ClimaCore &#8212; Scientific Computing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/module4-2_case_study_2_climacore';</script>
    <link rel="icon" href="../_static/SDSU-comp605_logo.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="14) Case Study 1: libCEED" href="module4-1_case_study_1_libceed.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-light" alt="Scientific Computing - Home"/>
    <script>document.write(`<img src="../_static/SDSU-comp605_logo.svg" class="logo__image only-dark" alt="Scientific Computing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../lectures.html">Lectures</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="module1-1_first_class.html">1) First Class: Reproducibility and Git</a></li>


<li class="toctree-l2"><a class="reference internal" href="module1-2_linux.html">2) The Linux Filesystem and commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-3_community_projects.html">3) Community Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-4_intro_architectures.html">4) Introduction to Computer Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="module1-5_intro_vectorization.html">5) Introduction to Vectorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-1_measuring_performance.html">6) Measuring Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-2_cpu_optimization.html">7) CPU Optimization: Matrix-Matrix Multiply</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-3_blocked_mmm.html">8) Blocked Matrix-Matrix Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-4_packing_for_cache.html">9) Packing for cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="module2-5_intro_multithreading.html">10) Introduction to Multithreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-1_intro_parallel_scaling.html">11) Introduction to Parallel Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-2_intro_to_openmp.html">12) Introduction to OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="module3-3_openmp_tasks.html">13) More on OpenMP and OpenMP Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="module4-1_case_study_1_libceed.html">14) Case Study 1: libCEED</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">15) Case Study 2: ClimaCore</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sdsu-comp605/spring25/issues/new?title=Issue%20on%20page%20%2Flectures/module4-2_case_study_2_climacore.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/module4-2_case_study_2_climacore.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>15) Case Study 2: ClimaCore</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esm">1. ESM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-dynamical-core-dycore">2. A dynamical core (dycore)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jl">3. ClimaCore.jl</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-discretization">3.1 Spatial Discretization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jl-api">3.2 ClimaCore.jl API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jls-composable-operators-and-julia-broadcasting">3.3 ClimaCore.jl’s composable <code class="docutils literal notranslate"><span class="pre">Operators</span></code> and Julia broadcasting</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-shallow-water-equations">Example: Shallow-water equations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-transport-advection-of-tracers">Example: Transport (advection) of tracers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-barotropic-instability">Example: barotropic instability</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-performance-plots">3.4 Some performance plots</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="case-study-2-climacore">
<h1>15) Case Study 2: <a class="reference external" href="https://github.com/CliMA/ClimaCore.jl">ClimaCore</a><a class="headerlink" href="#case-study-2-climacore" title="Link to this heading">#</a></h1>
<p>Last time:</p>
<ul class="simple">
<li><p>libCEED</p></li>
</ul>
<p>Today:</p>
<ol class="arabic simple">
<li><p>ESM</p></li>
<li><p>A dynamical core (dycore)</p></li>
<li><p>ClimaCore.jl<br />
3.1 Spatial Discretization<br />
3.2 ClimaCore.jl API
3.3 ClimaCore.jl’s composable <code class="docutils literal notranslate"><span class="pre">Operators</span></code> and Julia broadcasting
3.4 Some perfomance plots</p></li>
</ol>
<section id="esm">
<h2>1. ESM<a class="headerlink" href="#esm" title="Link to this heading">#</a></h2>
<p>An <strong>Eart System Moel (ESM)</strong> simulates how the Earth’s atmosphere, oceans, land, ice, and biosphere interact. ESMs are used to understand and predict how the Earth’s climate will change.</p>
<p>To understand Earth system models, it helps to first understand <strong>global climate models</strong>. Climate is the <em>long-term</em> pattern of weather variables. It includes temperature, rain and snowfall, humidity, sunlight, and wind and how they occur over many years. Climate models explain how these variables can change using mathematical analysis based on the physics of how energy, gases, and fluids move, combined with measurements taken from experiments, laboratories, and other observations in the real world.</p>
<p>Climate models include:</p>
<ul class="simple">
<li><p>The atmosphere including clouds, aerosols, and gases, the land surface and how it is covered by vegetation, snow and ice, lakes and rivers, and soil, sea ice and the oceans.</p></li>
<li><p>How all these components store and move the heat and carbon that warm the Earth’s atmosphere.</p></li>
<li><p>Global climate models treat the Earth as a giant grid. The size of each cell in the grid is determined by the power of the computer running the model.</p></li>
</ul>
<p>The goal of Earth system models is to understand how the Earth functions as a system of interdependent parts. These parts include the physical, chemical, and biological processes and interact with one another.</p>
<blockquote>
<div><p>Recommended Reading:
<a class="reference external" href="https://www.energy.gov/science/doe-explainsearth-system-and-climate-models">Department of Energy (DOE) explains Earth system and climate models</a>.</p>
</div></blockquote>
</section>
<section id="a-dynamical-core-dycore">
<h2>2. A dynamical core (dycore)<a class="headerlink" href="#a-dynamical-core-dycore" title="Link to this heading">#</a></h2>
<p>The mathematical and numerical modeling needed to solve the governing equations of the physics that drives global climate models is what constitutes a so-called <strong>dynamical core (dycore)</strong>. This may include:</p>
<ul class="simple">
<li><p>Meshing: discrete representation of the geometry</p></li>
<li><p>Numerical methods for spatial and temporal discretizations of the PDEs</p></li>
<li><p>How differential operators or different discretizations are composed to describe te full system</p></li>
<li><p>Definition and implementation of different boundary conditions</p></li>
</ul>
<p><img alt="A cubed sphere" src="../_images/CubedSphere.png" /></p>
</section>
<section id="climacore-jl">
<h2>3. <a class="reference external" href="https://github.com/CliMA/ClimaCore.jl">ClimaCore.jl</a><a class="headerlink" href="#climacore-jl" title="Link to this heading">#</a></h2>
<p>The dynamical core (<em>dycore</em>) of the <a class="reference external" href="https://clima.caltech.edu/">Climate Modeling Alliance (CliMA)</a> atmosphere model is designed for efficient simulation of a wide range of atmospheric flows across scales. From high-resolution regional scales defined in terms of Large Eddy Simulations (LES) to global circulation models (GCM).</p>
<p>The main goal of the CliMA project is to build an ESM that automatically learns from diverse data sources to produce accurate climate predictions with quantified uncertainties.</p>
<p>CliMA’s new Earth System Model (ESM) is entirely written in the Julia programming language.</p>
<p><img alt="Learning model in an ESM" src="../_images/Learning.png" /></p>
<p>The CliMA model targets both CPU and GPU architectures, using a common codebase. ClimaCore.jl constitutes the dynamical core (<em>dycore</em>) of the atmosphere and land models, providing discretization tools to solve the governing equations of the ESM component models.</p>
<p><img alt="The schematic of an ESM" src="../_images/ESMSchematic.png" /></p>
<p>ClimaCore.jl’s high-level application programming interface (API) facilitates modularity and composition of differential operators and the definition of flexible discretizations: Spectral Element Method (SEM) in the horizontal direction, coupled with staggered finite differences (FD) in the vertical direction. This approach leverages the high-order accuracy and scalability of the SEM, while maintaining the computational efficiency and stability of finite differences on a staggered grid. The model’s coordinate-independent equation set allows for simulations in a variety of geometries and planetary configurations.</p>
<p>ClimaCore.jl also presents low-level APIs that support different data layouts, specialized implementations, and flexible models for threading, to better face high-performance optimization, data storage, and scalability challenges on modern HPC architectures.</p>
<section id="spatial-discretization">
<h3>3.1 Spatial Discretization<a class="headerlink" href="#spatial-discretization" title="Link to this heading">#</a></h3>
<p>Geometry:</p>
<ul class="simple">
<li><p>Supports different geometries (Cartesian &amp; spherical).</p></li>
<li><p>Supports covariant vector representation for curvilinear, non-orthogonal systems and Cartesian vectors for Euclidean spaces.</p></li>
</ul>
<p><img alt="Vector representations in different bases" src="../_images/Bases.png" /></p>
<p>Space Discretizations:</p>
<ul class="simple">
<li><p>Horizontal: Support both Continuous Galerkin (CG) and Discontinuous Galerkin (DG).</p></li>
<li><p>Vertical: staggered Finite Differences (FD).</p></li>
</ul>
<p><img alt="Discretization Sketch" src="../_images/DiscretizationSketch.jpg" /></p>
</section>
<section id="climacore-jl-api">
<h3>3.2 ClimaCore.jl API<a class="headerlink" href="#climacore-jl-api" title="Link to this heading">#</a></h3>
<p>API objects:</p>
<ul class="simple">
<li><p>Domain, Mesh, Topology, Space, Field.</p></li>
</ul>
<p><img alt="ClimaCore.jl API objects" src="../_images/APIobjects.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">Field</span></code> abstraction:</p>
<ul class="simple">
<li><p>Scalar, Vector or Struct-valued.</p></li>
<li><p>Stores values, geometry, and mesh info.</p></li>
<li><p>Flexible memory layouts.</p></li>
<li><p>Useful overloads: <code class="docutils literal notranslate"><span class="pre">sum</span></code> (integral of a given field across the domain), <code class="docutils literal notranslate"><span class="pre">norm</span></code>, <code class="docutils literal notranslate"><span class="pre">mean</span></code>.</p></li>
<li><p>Compatible with DifferentialEquations.jl and ad-hoc time integrators.</p></li>
</ul>
<p><img alt="&quot;ClimaCore.jl space discretization code snippet&quot;" src="../_images/Space-discretization-snippet.png" /></p>
<p>Once you define a (scalar/vector) field on a space, you can easily use <a class="reference external" href="https://en.wikipedia.org/wiki/Reduction_operator">reduction operators</a>, using the same syntax, whether you run on a single process, single-threaded mode or parallel:</p>
<p><img alt="ClimaCore.jl sum code snippet" src="../_images/sum-ones-space-snippet.png" /></p>
</section>
<section id="climacore-jls-composable-operators-and-julia-broadcasting">
<h3>3.3 ClimaCore.jl’s composable <code class="docutils literal notranslate"><span class="pre">Operators</span></code> and Julia broadcasting<a class="headerlink" href="#climacore-jls-composable-operators-and-julia-broadcasting" title="Link to this heading">#</a></h3>
<p>Julia broadcasting:</p>
<ul class="simple">
<li><p>it applies a vectorized function point-wise to an array. Scalar values are “<em>broadcast</em>” over arrays;</p>
<ul>
<li><p>It can do fusion of multiple operations automatically.</p></li>
</ul>
</li>
<li><p>User-extensible API: can be specialized for custom functions or argument types (e.g., <code class="docutils literal notranslate"><span class="pre">CuArray</span></code> compiles and applies a custom CUDA kernel if you are running on an NVIDIA GPU).</p></li>
</ul>
<p><img alt="Julia broadcasting code snippet" src="../_images/Julia-broadcasting-snippet.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">Operators</span></code> (<code class="docutils literal notranslate"><span class="pre">grad</span></code> for gradient, <code class="docutils literal notranslate"><span class="pre">div</span></code> for divergence, <code class="docutils literal notranslate"><span class="pre">interpolate</span></code> for interpolation, etc.) are “pseudo-functions”:</p>
<ul class="simple">
<li><p>they act like functions when broadcasted over a <code class="docutils literal notranslate"><span class="pre">Field</span></code>, but can’t be called on a single value;</p></li>
<li><p>can be composed and fused with function calls</p></li>
<li><p><em>Matrix-free</em> representation, i.e., no assembly of the operator matrix, but the user only specifies the <em>action</em> of operator.</p></li>
</ul>
<p>Composition of multiple operators is very easy and user-fiendly. Example: a Diffusion (Laplacian) operator in weak form looks like this in ClimaCore.jl’s API:</p>
<p><img alt="Weak form diffusion operator in ClimaCore.jl" src="../_images/weak-form-diffusion-operator-snippet.png" /></p>
<section id="example-shallow-water-equations">
<h4>Example: Shallow-water equations<a class="headerlink" href="#example-shallow-water-equations" title="Link to this heading">#</a></h4>
<p><img alt="Shallow-water equations in ClimaCore.jl" src="../_images/ClimaCore_SWE.png" /></p>
<p>The shallow-water equations provide a test case for atmospheric flow simulations. One of the typical examples/test cases is the flow past a mountain:</p>
<p><img alt="Mountain shallow-water test case in ClimaCore.jl" src="../_images/mountain_height_day10_with_bg.gif" /></p>
</section>
<section id="example-transport-advection-of-tracers">
<h4>Example: Transport (advection) of tracers<a class="headerlink" href="#example-transport-advection-of-tracers" title="Link to this heading">#</a></h4>
<p><img alt="Transport of tracers equation in ClimaCore.jl" src="../_images/ClimaCore_transport_equation.png" /></p>
</section>
<section id="example-barotropic-instability">
<h4>Example: barotropic instability<a class="headerlink" href="#example-barotropic-instability" title="Link to this heading">#</a></h4>
<p>A more complicated example/test case for a global circulation model (GCM) is the barotropic instability. The GIF below shows a 10-day simulation:</p>
<p><img alt="Barotropic instability test case in ClimaCore.jl" src="../_images/barotropic_instability_vorticity_day10_with_bg_short.gif" /></p>
<blockquote>
<div><p>Other Examples:</p>
<ul class="simple">
<li><p>Other examples can be found at <a class="reference external" href="https://github.com/CliMA/ClimaCore.jl/tree/main/examples">ClimaCore.jl/examples</a> divided by domain geometries:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">column/</span></code>: 1D examples in the vertical direction only. These require interpolating quantities on the staggered grid (from face values to center values and viceversa)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plane/</span></code>: 2D examples on a rectangular grid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphere/</span></code>: 2D examples on a spherical grid</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hybrid/</span></code>: collects 3D examples with a hybrid mesh, i.e., with spectral element discretization in the horizontal direction and staggered finite difference in the vertical direction, in both Cartesian (2D <code class="docutils literal notranslate"><span class="pre">plane/</span></code> and 3D <code class="docutils literal notranslate"><span class="pre">box/</span></code>) and spherical grids (<code class="docutils literal notranslate"><span class="pre">sphere/</span></code>)</p></li>
</ul>
</li>
</ul>
</div></blockquote>
</section>
</section>
<section id="some-performance-plots">
<h3>3.4 Some performance plots<a class="headerlink" href="#some-performance-plots" title="Link to this heading">#</a></h3>
<p>To examine strong scaling in climate models, it is customary to increase the number of processors for several fixed resolutions, <span class="math notranslate nohighlight">\(\delta x\)</span>, and determine the time-to-solution in <strong>symulated years per day (SYPD)</strong>.</p>
<p>In the following plots, several resolution results are presented, from the coarsest resolution, <span class="math notranslate nohighlight">\(103\)</span> km (<span class="math notranslate nohighlight">\(N_e = 30 \times 30\)</span> horizontal elements on each cubed sphere panel), to the finest, <span class="math notranslate nohighlight">\(13\)</span> km (<span class="math notranslate nohighlight">\(N_e = 240 \times 240\)</span> horizontal elements on each cubed sphere panel), for the moist baroclinic wave test as a benchmark.</p>
<p>The GPUs (left) are NVIDIA A100 GPUs, and the CPU (right) nodes consist of 32-core Intel Icelake 8352Y processors, with 16 MPI ranks per CPU node.</p>
<p><img alt="CliMA dycore strong scaling plots" src="../_images/CliMA_dycore_strong_scaling.png" /></p>
<p>For weak scaling studies, the problem resolution (and therefore problem size) varies with the resources in the system. Here we plot <strong>time per model timestep</strong> versus number of GPUs (left) and CPU nodes (right) for different horizontal resolutions.</p>
<p><img alt="CliMA dycore weak scaling plots" src="../_images/CliMA_dycore_weak_scaling.png" /></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "sdsu-comp605/spring25",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="module4-1_case_study_1_libceed.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">14) Case Study 1: libCEED</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esm">1. ESM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-dynamical-core-dycore">2. A dynamical core (dycore)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jl">3. ClimaCore.jl</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-discretization">3.1 Spatial Discretization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jl-api">3.2 ClimaCore.jl API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climacore-jls-composable-operators-and-julia-broadcasting">3.3 ClimaCore.jl’s composable <code class="docutils literal notranslate"><span class="pre">Operators</span></code> and Julia broadcasting</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-shallow-water-equations">Example: Shallow-water equations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-transport-advection-of-tracers">Example: Transport (advection) of tracers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example-barotropic-instability">Example: barotropic instability</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#some-performance-plots">3.4 Some performance plots</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Valeria Barra
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>